## Барьер [barrier]


Барьер (barrier) - примитив синхронизации для n потоков, который представляет собой виртуальную границу в коде, пересечь которую могут только все n потоков одновременно.


Барьер при создании конфигурируется числом потоков, которые будут с ним работать. 


Барьер предоставляет потокам единственный метод ```enter()```: когда поток хочет пройти через барьер, он вызывает этот метод и блокируется до тех пор, пока к барьеру не подойдут все остальные потоки (т.е. до тех пор, пока все они также не вызовут ```enter()```). Поток, последним вызвавший ```enter()```, разблокирует все ожидающие потоки, после чего барьер считается пройденным.


Реализуйте барьер с помощью мьютекса и условной переменной.


Барьер называется циклическим (cyclic) или повторно используемым (reusable), если его можно заново использовать после того, как через него прошли все потоки. Т.е. поток, прошедший через вызов ```enter()```, может вызвать его повторно и снова ждать всех остальных потоков. 


Реализуйте циклический барьер с помощью мьютекса и условной переменной.

---

Зачем вообще нужны барьеры: они применяются в параллельных итеративных алгоритмах: работа на каждой итерации разбивается на независимые части для выполнения в разных потоках, но перейти к следующей итерации можно только если все потоки уже завершили работу на текущей итерации. 


Пример: какой-нибудь матричный алгоритм или моделирование в игре Life.

ВНИМАНИЕ: Не путайте барьер как примитив синхронизации с барьерами памяти (memory barriers или memory fences) которые используются для обеспечения упорядоченности (memory ordering) чтений/записей.


---


Реализуйте класс cyclic_barrier, положите реализацию в хедер cyclic_barrier.h


Напишите простой тест: запустите несколько потоков и пусть каждый из них несколько итераций делает следующее: сначала засыпает на случайное число секунд от 1 до 10, после чего вызывает barrier.enter(), после чего печатает на экран свой std::this_thread::id()


Напишите stress-тест: запустите 10 потоков, каждый из которых пройдет через барьер 100000 раз. Если в реализации есть race condition, приводящий к зависанию потоков в barrier.enter(), то он с большой вероятностью проявится.